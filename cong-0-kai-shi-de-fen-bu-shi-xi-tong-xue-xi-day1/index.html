<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KainHao的博客</title>
<meta name="description" content="一只咸鱼的博客" />
<link rel="shortcut icon" href="https://www.geekore.ink/favicon.ico?v=1614940016896">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://www.geekore.ink/styles/main.css">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="ri-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://www.geekore.ink">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://www.geekore.ink/images/avatar.png?v=1614940016896" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">KainHao的博客</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            文章目录
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li><a href="#0x00-%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">0x00 写在前面</a></li>
<li><a href="#0x01-%E4%BB%80%E4%B9%88%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E6%80%8E%E4%B9%88%E8%A1%A1%E9%87%8F%E4%B8%80%E4%B8%AA%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%A5%BD%E5%9D%8F">0x01 什么是分布式系统?怎么衡量一个分布式系统的好坏?</a></li>
<li><a href="#0x02-%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E5%8F%AF%E7%94%A8%E6%80%A7%E4%B8%8E%E4%B8%80%E8%87%B4%E6%80%A7">0x02 可扩展性,可用性与一致性</a>
<ul>
<li><a href="#1-%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7scalability">.1 可扩展性(Scalability)</a></li>
<li><a href="#2-%E5%8F%AF%E7%94%A8%E6%80%A7availability">.2 可用性(Availability)</a></li>
<li><a href="#3-%E4%B8%80%E8%87%B4%E6%80%A7consistency">.3 一致性(Consistency)</a></li>
</ul>
</li>
<li><a href="#0x03-cap%E5%AE%9A%E7%90%86%E4%B8%8Ebase%E7%90%86%E8%AE%BA">0x03 CAP定理与BASE理论</a>
<ul>
<li><a href="#1-cap%E5%AE%9A%E7%90%86">.1 CAP定理</a></li>
<li><a href="#2-base%E7%90%86%E8%AE%BA">.2 BASE理论</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="ri-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          关于
        </a>
      
    
      
        <a href="https://www.geekore.ink/you-lian" class="menu" style="animation-delay: 0.8s">
          友链
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700">All content on this site is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC-BY-NC-ND 4.0 </a> agreement. <br />
Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></div>
    <a class="rss" href="https://www.geekore.ink/atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">从0开始的分布式系统学习Day1</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2021-02-19 / 7 min read
        </div>
        
        <div class="post-content yue">
          <p><s>换到了Vercel,为什么觉得比GitHub Pages还慢</s></p>
<hr>
<h1 id="0x00-写在前面">0x00 写在前面</h1>
<p>这几篇文章可能更多注重分布式系统的操作,毕竟我可没胆子在MIT前面讲分布式233</p>
<h1 id="0x01-什么是分布式系统怎么衡量一个分布式系统的好坏">0x01 什么是分布式系统?怎么衡量一个分布式系统的好坏?</h1>
<p>提到分布式,在座的各位站长会想到什么?<br>
对,负载均衡和CDN.<br>
这是分布式最常见的应用,还有包括分布式灾备系统,分布式计算 <s>(我宣布,DCE天下第一)</s> 等都是<em>分布式</em>的应用.</p>
<p>概括地来说:<br>
分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统。<br>
分布式是不同的业务模块部署在不同的服务器上或者同一个业务模块分拆多个子业务，部署在不同的服务器上，解决高并发的问题。<br>
集群是同一个业务部署在多台机器上，提高系统可用性。</p>
<p>那么怎么比较CloudFlare的CDN和腾讯云境内CDN呢?<br>
下面是几项衡量分布式系统的指标:</p>
<ul>
<li>性能. 性能包括吞吐量和响应时间.这两个指标常常是互相矛盾的,追求高吞吐的系统,往往很难做到低响应时间,反之亦然.</li>
<li>一致性(Consistency). 分布式系统中多台计算机中数据的一致性.</li>
<li>可用性(Availability). 在面对异常时仍然提供正常服务的能力</li>
<li>可扩展性(Scalability). 如果两台计算机构成的系统有两倍性能或者吞吐，就是可扩展性.</li>
</ul>
<h1 id="0x02-可扩展性可用性与一致性">0x02 可扩展性,可用性与一致性</h1>
<h2 id="1-可扩展性scalability">.1 可扩展性(Scalability)</h2>
<p>当一个系统 <s>被迫</s> 走向分布式的时候,可扩展性通常是最重要的理由.<br>
下面是一个例子:</p>
<blockquote>
<p>假如我经营的这个博客突然因为某篇文章火了起来,那么我需要的就不仅仅是Vercel和GitHub的免费托管. 我当然可以花时间把这套模板优化到极致,但更好的做法是,部署更多的Web服务器并利用CDN.</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://img.yunwuo.com/images/2021/02/22/be1b5a21ae01522006bc6caa69344a88.png" alt="一个典型的分布式系统就是CDN" loading="lazy"></figure>
<p>然而这个方法并不能无限提高服务的性能,因为瓶颈往往会出现在这里或那里,例如:</p>
<blockquote>
<p>这个博客是纯粹的静态网站,所以当然不需要利用数据库,可是假如这个网站是由PHP+MySQL构建的,那么在你增添了Web服务器后,瓶颈就出现在服务器与数据库的通信上——别忘了,我们还没有考虑到增加几台数据库.</p>
</blockquote>
<p>所以,有关扩展性是这样: 我们希望可以通过增加机器的方式来实现扩展,但是现实中这很难实现,需要一些架构设计来将这个可扩展性无限推进下去.</p>
<h2 id="2-可用性availability">.2 可用性(Availability)</h2>
<p>说到可用性,我推荐你先去买一本书:<br>
<img src="https://img.yunwuo.com/images/2021/02/22/6f252d189250e8c45a5c53131df1ecd7.png" alt="" loading="lazy"><br>
购买地址在这里: <a href="https://item.jd.com/53990252028.html">正版包邮5本李居明学风水的第一本书+大师教你看八字+看面相+看楼盘+姓名改运学 入门住宅玄学</a><br>
(京东,打钱!)<br>
当然,不是因为这事真的跟风水和玄学有什么关系,而是维持一个分布式系统的高可用实在太难了.<br>
当你有一台服务器或者电脑在运行的时候,通常错误很少或者根本不会发生错误,比如我手边这台2013年的MacBook Air. 它已经为我工作了七年,期间经受过我的种种折磨 <s>比如开虚拟机挖矿</s>,仍能正常启动并工作<br>
但是当你有1000台服务器的时候,问题常常会发生在意想不到的地方,一些罕见的错误也会被无限放大.即使每台服务器都可以稳定运行一年, 也意味着每天会有3台计算机出错.<br>
在讨论要如何解决这些问题之前,我们先来复习一下经常遇到的异常:</p>
<ul>
<li>服务器宕机. 内存错误,停电等都会导致宕机,此时节点被称为不可用.而宕机会导致内存丢失.</li>
<li>网络错误. 例如通信链路不可用,网络分区错误,响应超时等.</li>
<li>磁盘故障.<br>
所以在设计一个分布式系统时,必须一开始就考虑容错的问题.尽管容错的方法有很多,但其中有两个最核心的思想,即可用性(Availability)和自我恢复性(Recoverability).<br>
系统经过精心的设计,这样在特定的错误类型下,系统仍然能够正常运行,仍然可以像没有出现错误一样,为你提供完整的服务.<br>
对于一个具备可用性的系统,为了让系统在实际中具备应用意义,也需要具备可恢复性.因为可用的系统仅仅是在一定的故障范围内才可用,如果故障太多,可用系统也会停止工作,停止一切响应.但是当足够的故障被修复之后,系统还是需要能继续工作.所以,一个好的可用的系统,某种程度上应该也是可恢复的.当出现太多故障时,系统会停止响应,但是修复之后依然能正确运行.这是我们期望看到的.</li>
</ul>
<h2 id="3-一致性consistency">.3 一致性(Consistency)</h2>
<p>一致性通常被分为四个等级(由强至弱):</p>
<ul>
<li>Strict Consistency</li>
<li>Linearizable Consistency</li>
<li>Sequential Consistency</li>
<li>Causal Consistency(一般来讲,最弱)</li>
<li>Eventual Consistency(具体可参考MySQL的异步复制)<br>
在这篇文章中不讨论各个等级的原则,只简单说明强一致与弱一致各自的优劣.<br>
现在假设:</li>
</ul>
<blockquote>
<p>你有2000台运行数据库的服务器.假如使用强一致,当我对其中一台的数据库做修改时,这个系统可能要耗费几十秒乃至几分钟的时间在2000个节点中同步我的一次修改.<br>
因此强一致带来昂贵的通信问题,因为每次你执行put或者get请求,你都需要等待几十毫秒来与数据的两个副本通信,以确保它们都被更新了或者都被检查了以获得最新的数据.现在的处理器每秒可以执行数十亿条指令,等待几十毫秒会大大影响系统的处理速度.<br>
所以,人们常常会使用弱一致系统,你只需要更新最近的数据副本,并且只需要从最近的副本获取数据.</p>
</blockquote>
<h1 id="0x03-cap定理与base理论">0x03 CAP定理与BASE理论</h1>
<h2 id="1-cap定理">.1 CAP定理</h2>
<p><img src="https://img.yunwuo.com/images/2021/02/22/bffb0a10bc22bf2d5f1cd05e7c858683.png" alt="" loading="lazy"><br>
一致性(C): 在分布式系统中的所有数据备份,在同一时刻是否同样的值.(等同于所有节点访问同一份最新的数据副本)<br>
可用性(A): 保证每个请求不管成功或者失败都有响应.<br>
分区容忍性(P): 系统中任意信息的丢失或失败不会影响系统的继续运作.<br>
这个定理的特点在于C\A\P不可得兼,你只能选择其中的两个甚至一个.<br>
通常来说,容错(分区容忍性)是被优先考虑的,需要在CA中权衡.</p>
<h2 id="2-base理论">.2 BASE理论</h2>
<p>BASE理论强调:</p>
<ul>
<li>基本可用 (Basically Available)</li>
<li>软状态 (Soft State)</li>
<li>最终一致性 (Eventually Consistent)<br>
总体来说BASE理论面向的是大型高可用、可扩展的分布式系统。与传统ACID特性相反，不同于ACID的强一致性模型，BASE提出通过牺牲强一致性来获得可用性，并允许数据段时间内的不一致，但是最终达到一致状态。同时，在实际分布式场景中，不同业务对数据的一致性要求不一样。因此在设计中，ACID和BASE理论往往又会结合使用。</li>
</ul>

        </div>

        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://www.geekore.ink/tan-zi-or-liao-liao-wei-lai-de-it-xing-ye/">
                <h3 class="post-title">
                  <i class="ri-arrow-left-line"></i>
                  [谈资] | 聊聊未来的IT行业
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://www.geekore.ink/python-json/">
                <h3 class="post-title">
                  Python json库
                  <i class="ri-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        

      </div>
    </div>

    <script src="https://www.geekore.ink/media/prism.js"></script>  
<script>

Prism.highlightAll()
let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
